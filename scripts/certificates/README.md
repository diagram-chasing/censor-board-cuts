# censor-board-cuts certificates script

The certificates pipeline fetches film certificates from the Central Board of Film Certification (CBFC) India website.

## Usage

To run the certificates pipeline with default settings:
```bash
python main.py
```

## Pipeline Workflow (Default)

- **Process**:
  - Scrapes certificate data from CBFC website
  - Uses list of certificate IDs from `certificates.txt`
  - Collects certificate metadata for valid IDs

- **Output Data**:
  - Metadata: `../../data/raw/metadata.csv`
  - Modifications: `../../data/raw/modifications.csv`

### Certificate IDs

The list of certificate IDs is stored in `certificates.txt`. These are exported from the list of certificate URLs contributed on the [CBFC Watch](https://cbfc.watch) contributions page and stored in a Cloudflare KV namespace. Use the command `wrangler kv key list --namespace-id $NAMESPACE_ID --remote | jq '.[] | .metadata.certificateUrl' > certificates.txt` to export the list of certificate URLs from the KV namespace to the `certificates.txt` file.

**Certificate ID Formats:**
The system now supports two certificate ID formats:
1. **Legacy numeric format**: 16-digit numbers like `100090292400000145`
2. **New encoded format**: Base64-encoded strings like `YRZpHtUg5GVvseP6R9BFd5BV0z2zrja4PEK6XhOlioc=`

The scripts automatically handle both formats. For encoded IDs containing special characters (`/`, `+`, `=`), the system sanitizes these for filename storage by replacing them with safe alternatives (`_`, `_plus_`, `_eq_`).

## Pipeline Workflow with --generate-ids flag

- **Process**:
  - Scrapes certificate data from CBFC website
  - Generates certificate IDs systematically for each regional office and year (legacy numeric format only)
  - Terminates scraping for a region+year combination after encountering consecutive invalid IDs
  - Collects certificate metadata for valid IDs

**Note:** The `--generate-ids` flag only generates legacy numeric format certificate IDs. For new encoded certificate IDs, use the default workflow with `certificates.txt`.

- **Output Data**:
  - Metadata: `../../data/raw/metadata.csv`
  - Modifications: `../../data/raw/modifications.csv`

### Certificate ID Structure

Each certificate ID is a 16-digit number structured as follows:

1. The first 4 digits are always "1000"
2. The 5th digit indicates the CBFC regional office (see region codes below)
3. The 6th digit is always "0"
4. Digits 7-10 represent the year (add 900 to the year)
5. The last 8 digits are sequential numbers

CBFC Regional Office Codes:

- 1 = Mumbai
- 2 = Bangalore
- 3 = Chennai
- 4 = Cuttack
- 5 = Delhi
- 6 = Guwahati
- 7 = Hyderabad
- 8 = Kolkata
- 9 = Thiruvananthapuram

Example, the certificate ID `100090292400000109`:

- "9" in position 5 indicates Thiruvananthapuram regional office
- "2924" in positions 7-10 represents year 2024 (2024 + 900 = 2924)

## Notes

For now, we scrape from 1 to infinity for each combination of state+year, and terminate the scraping for a state+year after encountering consecutive IDs that turn out to be invalid. A little hacky! Unfortunately, there's no database of valid IDs so this brute force approach is what we're stuck with.

## AI Disclaimer

This code was mostly generated by Claude, using Cursor.
